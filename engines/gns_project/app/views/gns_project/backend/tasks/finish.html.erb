<% content_for :title do %>
    <%= t('.finish_task') %> - <%= @task.name %>
<% end %>

<% content_for :page_script do %>
    <script>
        $(document).ready(function() {
            $('.finish_task').submit(function(e) {
                e.preventDefault();                
                var form = $(this);
                
                // clear modal
                finish_task_modal.clear();
                
                $.ajax({
                    url: form.attr('action'),
                    method: form.attr('method'),
                    data: form.serialize() + '&layout=modal',
                }).done(function(response) {
                    if (typeof(response.status) !== 'undefined') {
                      showNotification(response.status, response.message);
                      finish_task_modal.hide();
                      
                      // load task list
                      if (typeof(finish_task_callback) !== 'undefined') {
                        finish_task_callback();
                      }
                    } else {
                      finish_task_modal.renderHtml(response);
                    }
                });
                
                return false;
            });
        });
    </script>
<% end %>

<div class="card">
    <div class="card-body">
        <%= form_for '', url: gns_project.finish_backend_tasks_path(id: @task.id), html: {multipart: false, class: 'finish_task'} do |f| %>
            <h5><%= t('.finish_confirm').html.safe %></h5>
            
            <div class="form-group">
                <textarea rows="2" cols="5"
                    class="form-control <%= 'border-danger' if @task.errors.full_messages_for(:remark).present? %>"
                    placeholder="<%= t('.enter_your_remark_here') %>"
                    name="remark"
                ></textarea>
                <% if @task.errors.full_messages_for(:remark).present? %>
                    <span class="form-text text-danger"><%= @task.errors.full_messages_for(:remark).join('<br/>').html_safe %></span>
                <% end %>
            </div>
            
            <div class="text-left">
                <button type="submit" class="btn btn-primary"><%= t('.finish_confirm') %></button>
            </div>
        <% end %>
    </div>
</div>